<div class="companies-page container">
  <header class="page-header">
    <h1 class="page-title">鉄道会社管理</h1>
    <button class="neu-button" (click)="onCreateClick()">
      新規作成
    </button>
  </header>

  <!-- Search Panel Component -->
  <app-company-search-panel
    [searchTerm]="searchTerm"
    [selectedType]="selectedType"
    [selectedStatus]="selectedStatus"
    [total]="total"
    [loading]="loading"
    (search)="onSearchSubmit()"
    (clear)="onClearFilters()"
    (valueChanges)="onSearchFiltersChange($event)"
  ></app-company-search-panel>

  <!-- Loading State -->
  @if (loading) {
    <app-loading-spinner message="鉄道会社データを読み込み中..."></app-loading-spinner>
  }

  <!-- Error State -->
  @if (error && !loading) {
    <app-error-message 
      [error]="error" 
      (retry)="onRetryLoad()"
    ></app-error-message>
  }

  <!-- Company List Component -->
  @if (!loading && !error && companies.length > 0) {
    <app-company-list
      [companies]="companies"
      [currentPage]="currentPage"
      [totalPages]="totalPages"
      [total]="total"
      [limit]="limit"
      (editClick)="onCompanyEdit($event)"
      (deleteClick)="onCompanyDelete($event)"
      (pageChange)="onPageChange($event)"
    ></app-company-list>
  }

  <!-- Empty State -->
  @if (!loading && !error && companies.length === 0) {
    <div class="empty-state neu-card">
      <h3>鉄道会社が見つかりません</h3>
      <p>検索条件を変更するか、新しい鉄道会社を作成してください。</p>
      <button class="neu-button mt-4" (click)="onCreateClick()">
        新規作成
      </button>
    </div>
  }

  <!-- Create Form Modal -->
  @if (showCreateForm) {
    <div class="modal-overlay">
      <div class="modal-content neu-card">
        <div class="modal-header">
          <h2>新しい鉄道会社を作成</h2>
          <button class="close-button" (click)="onCancelCreate()">×</button>
        </div>
        
        <form class="company-form" (submit)="onCreateSubmit(); $event.preventDefault()">
          <div class="form-grid">
            <div class="form-group">
              <label for="create-code">事業者コード *</label>
              <input 
                id="create-code"
                type="number" 
                class="neu-input"
                [value]="newCompany.companyCode"
                (input)="newCompany.companyCode = +$any($event.target).value"
                required
              >
            </div>
            
            <div class="form-group">
              <label for="create-railway">鉄道コード *</label>
              <input 
                id="create-railway"
                type="number" 
                class="neu-input"
                [value]="newCompany.railwayCode"
                (input)="newCompany.railwayCode = +$any($event.target).value"
                min="10"
                max="99"
                required
              >
            </div>
            
            <div class="form-group span-2">
              <label for="create-name">会社名 *</label>
              <input 
                id="create-name"
                type="text" 
                class="neu-input"
                [value]="newCompany.companyName"
                (input)="newCompany.companyName = $any($event.target).value"
                required
              >
            </div>
            
            <div class="form-group span-2">
              <label for="create-kana">会社名カナ</label>
              <input 
                id="create-kana"
                type="text" 
                class="neu-input"
                [value]="newCompany.companyNameKana"
                (input)="newCompany.companyNameKana = $any($event.target).value"
              >
            </div>
            
            <div class="form-group span-2">
              <label for="create-official">正式名称</label>
              <input 
                id="create-official"
                type="text" 
                class="neu-input"
                [value]="newCompany.companyNameOfficial"
                (input)="newCompany.companyNameOfficial = $any($event.target).value"
              >
            </div>
            
            <div class="form-group span-2">
              <label for="create-url">WebサイトURL</label>
              <input 
                id="create-url"
                type="url" 
                class="neu-input"
                [value]="newCompany.companyUrl"
                (input)="newCompany.companyUrl = $any($event.target).value"
              >
            </div>
            
            <div class="form-group">
              <label for="create-type">事業者区分</label>
              <select 
                id="create-type"
                class="neu-select"
                [value]="newCompany.companyType"
                (change)="newCompany.companyType = +$any($event.target).value"
              >
                <option [value]="CompanyType.OTHER">その他</option>
                <option [value]="CompanyType.JR">JR</option>
                <option [value]="CompanyType.MAJOR_PRIVATE">大手私鉄</option>
                <option [value]="CompanyType.SEMI_MAJOR_PRIVATE">準大手私鉄</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="create-status">運用状態</label>
              <select 
                id="create-status"
                class="neu-select"
                [value]="newCompany.status"
                (change)="newCompany.status = +$any($event.target).value"
              >
                <option [value]="CompanyStatus.ACTIVE">運用中</option>
                <option [value]="CompanyStatus.PRE_OPERATION">運用前</option>
                <option [value]="CompanyStatus.ABOLISHED">廃止</option>
              </select>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="button" class="neu-button secondary" (click)="onCancelCreate()">
              キャンセル
            </button>
            <button type="submit" class="neu-button success">
              作成
            </button>
          </div>
        </form>
      </div>
    </div>
  }

  <!-- Edit Form Modal -->
  @if (editingCompany) {
    <div class="modal-overlay">
      <div class="modal-content neu-card">
        <div class="modal-header">
          <h2>鉄道会社を編集</h2>
          <button class="close-button" (click)="onCancelEdit()">×</button>
        </div>
        
        <form class="company-form" (submit)="onUpdateSubmit(); $event.preventDefault()">
          <div class="form-grid">
            <div class="form-group">
              <label for="edit-code">事業者コード</label>
              <input 
                id="edit-code"
                type="number" 
                class="neu-input"
                [value]="editingCompany.companyCode"
                readonly
              >
            </div>
            
            <div class="form-group">
              <label for="edit-railway">鉄道コード</label>
              <input 
                id="edit-railway"
                type="number" 
                class="neu-input"
                [value]="editingCompany.railwayCode"
                (input)="editingCompany.railwayCode = +$any($event.target).value"
                min="10"
                max="99"
              >
            </div>
            
            <div class="form-group span-2">
              <label for="edit-name">会社名</label>
              <input 
                id="edit-name"
                type="text" 
                class="neu-input"
                [value]="editingCompany.companyName"
                (input)="editingCompany.companyName = $any($event.target).value"
              >
            </div>
            
            <div class="form-group span-2">
              <label for="edit-kana">会社名カナ</label>
              <input 
                id="edit-kana"
                type="text" 
                class="neu-input"
                [value]="editingCompany.companyNameKana"
                (input)="editingCompany.companyNameKana = $any($event.target).value"
              >
            </div>
            
            <div class="form-group span-2">
              <label for="edit-official">正式名称</label>
              <input 
                id="edit-official"
                type="text" 
                class="neu-input"
                [value]="editingCompany.companyNameOfficial"
                (input)="editingCompany.companyNameOfficial = $any($event.target).value"
              >
            </div>
            
            <div class="form-group span-2">
              <label for="edit-url">WebサイトURL</label>
              <input 
                id="edit-url"
                type="url" 
                class="neu-input"
                [value]="editingCompany.companyUrl"
                (input)="editingCompany.companyUrl = $any($event.target).value"
              >
            </div>
            
            <div class="form-group">
              <label for="edit-type">事業者区分</label>
              <select 
                id="edit-type"
                class="neu-select"
                [value]="editingCompany.companyType"
                (change)="editingCompany.companyType = +$any($event.target).value"
              >
                <option [value]="CompanyType.OTHER">その他</option>
                <option [value]="CompanyType.JR">JR</option>
                <option [value]="CompanyType.MAJOR_PRIVATE">大手私鉄</option>
                <option [value]="CompanyType.SEMI_MAJOR_PRIVATE">準大手私鉄</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="edit-status">運用状態</label>
              <select 
                id="edit-status"
                class="neu-select"
                [value]="editingCompany.status"
                (change)="editingCompany.status = +$any($event.target).value"
              >
                <option [value]="CompanyStatus.ACTIVE">運用中</option>
                <option [value]="CompanyStatus.PRE_OPERATION">運用前</option>
                <option [value]="CompanyStatus.ABOLISHED">廃止</option>
              </select>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="button" class="neu-button secondary" (click)="onCancelEdit()">
              キャンセル
            </button>
            <button type="submit" class="neu-button success">
              更新
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>